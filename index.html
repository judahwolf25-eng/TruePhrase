<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TruePhrase - AI Text Generator</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // Initialize Supabase client immediately
        const supabaseUrl = 'https://hewhknielaqwizaybexa.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhld2hrbmllbGFxd2l6YXliZXhhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEwOTMxNDksImV4cCI6MjA3NjY2OTE0OX0.1SxnsD1KOK9r12DzjqhNzAf8tnrRwQMu3IHbmbDefyg'
        
        // Create Supabase client after window loads
        let supabaseClient;
        window.addEventListener('load', () => {
            supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
        });
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            background-color: #000000;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
            background-color: #000000;
        }
        /* Top Navigation Bar */
        .top-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #000000;
            padding: 15px 40px;
            display: flex;
            justify-content: center;
            gap: 40px;
            z-index: 99999;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .top-nav button {
            background: #000000;
            border: none;
            color: #ffffff;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 6px;
            transition: background-color 0.3s ease;
            opacity: 0.8;
        }
        
        .top-nav button:hover {
            background: #333333;
        }
        
        .top-nav button.active {
            background: #555555;
        }
        
        .top-nav button.locked {
            filter: blur(1px);
            opacity: 0.6;
            cursor: not-allowed;
            position: relative;
        }
        
        .top-nav button.locked::after {
            content: 'ðŸ”’';
            position: absolute;
            right: -25px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            filter: none;
            opacity: 1;
        }
        
        /* Centered single-column homepage */
        .centered-homepage {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            padding: 80px 40px 40px 40px;
            width: 100vw;
            background: #000000;
            color: #ffffff;
            margin: 0;
            position: relative;
            z-index: 1001;
            overflow: auto;
            transition: min-height 0.5s ease;
        }
        
        /* Extended height when content is shown */
        .centered-homepage.extended {
            min-height: 160vh;
        }
        
        /* Initial content wrapper - centers first 3 sections */
        .initial-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 160px); /* Account for padding */
            position: relative;
            z-index: 2;
        }
        
        /* Light blue gradient aura */
        .centered-homepage::before {
            content: '';
            position: fixed;
            bottom: 0;
            right: 0;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(
                ellipse 80vw 60vh at bottom right,
                rgba(147, 197, 253, 0.25) 0%,
                rgba(147, 197, 253, 0.18) 20%,
                rgba(191, 219, 254, 0.12) 40%,
                rgba(191, 219, 254, 0.08) 60%,
                rgba(219, 234, 254, 0.04) 80%,
                transparent 100%
            );
            pointer-events: none;
            z-index: 0;
            opacity: 0;
            animation: fadeInGradient 0.5s ease-out 0s forwards;
        }
        
        @keyframes fadeInGradient {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        
        /* Left half - Black background */
        .left-section {
            background: #000000;
            color: #ffffff;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
        }
        
        /* Right half - Image background */
        .right-section {
            background: #87CEEB;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: auto;
        }
        
        .right-section img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        /* Navigation */
        .nav-links {
            display: flex;
            gap: 30px;
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        
        .nav-links a {
            color: #ffffff;
            text-decoration: none;
            transition: opacity 0.3s ease;
        }
        
        .nav-links a:hover {
            opacity: 0.7;
        }
        
        /* Main branding */
        .main-brand {
            font-size: clamp(40px, 5vw, 80px);
            font-weight: 800;
            letter-spacing: -0.02em;
            line-height: 0.9;
            margin: 0;
        }
        
        /* Definition */
        .brand-definition {
            font-size: 14px;
            font-weight: 400;
            line-height: 1.4;
            margin-top: 20px;
            opacity: 0.8;
        }
        
        /* Home branding */
        .home-branding {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
            z-index: 3;
        }
        
        /* Waitlist section centered */
        .waitlist-section-centered {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 40px;
            position: relative;
            z-index: 3;
        }
        
        /* Home description */
        .home-description {
            font-size: 20px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            max-width: 600px;
            text-align: center;
            margin-top: 20px;
            margin-bottom: 40px;
            position: relative;
            z-index: 3;
            letter-spacing: 0.5px;
            text-shadow: 0 2px 8px rgba(147, 197, 253, 0.3);
            color: #ffffff;
        }
        
        /* Toggle Development Button */
        .toggle-dev-button {
            background: transparent;
            border: 1px solid #93C5FD;
            color: #93C5FD;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            margin-bottom: 5px;
            position: relative;
            z-index: 2;
        }
        
        .toggle-dev-button:hover {
            background: rgba(147, 197, 253, 0.1);
            border-color: #DBEAFE;
            color: #DBEAFE;
        }
        
        /* Development Status */
        .development-status {
            max-width: 700px;
            text-align: center;
            margin-top: 5px;
            position: relative;
            z-index: 2;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .status-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 0.5px;
            margin-bottom: 20px;
        }
        
        .status-badge.in-progress {
            background: linear-gradient(135deg, #93C5FD 0%, #DBEAFE 100%);
            color: #000000;
        }
        
        .development-status h3 {
            font-size: 24px;
            color: #ffffff;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .development-status p {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .development-status ul {
            list-style: none;
            padding: 0;
            text-align: left;
            display: inline-block;
        }
        
        .development-status li {
            font-size: 15px;
            color: rgba(255, 255, 255, 0.85);
            margin-bottom: 12px;
            padding-left: 25px;
            position: relative;
            line-height: 1.5;
        }
        
        .development-status li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: #93C5FD;
            font-weight: bold;
            font-size: 18px;
        }
        
        /* About page styled bullets */
        #view-about li {
            color: #DBEAFE;
            font-weight: 500;
        }
        
        #view-about li::before {
            content: 'âœ“';
            color: #93C5FD;
            font-weight: bold;
            margin-right: 8px;
        }
        
        #view-about p {
            color: #DBEAFE;
        }
        
        #view-about h2 {
            background: linear-gradient(135deg, #93C5FD 0%, #DBEAFE 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            letter-spacing: -0.5px;
        }
        
        /* Studio description */
        .studio-description {
            font-size: 20px;
            font-weight: normal;
            font-family: serif;
            line-height: 1.6;
            max-width: 80%;
            margin-top: auto;
            text-align: center;
            margin-left: auto;
            margin-right: auto;
        }
        
        .studio-description h3 {
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 8px 0;
            color: #ffffff;
        }
        
        /* Learn More Button */
        .learn-more-btn {
            background: transparent;
            border: 2px solid #ffffff;
            color: #ffffff;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 500;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            font-family: 'Inter', sans-serif;
        }
        
        .learn-more-btn:hover {
            background: #ffffff;
            color: #000000;
        }
        
        /* About page gradient aura */
        .about-page-with-gradient {
            position: relative;
            overflow: auto;
        }
        
        .about-page-with-gradient::before {
            content: '';
            position: fixed;
            bottom: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(
                ellipse 80vw 60vh at bottom right,
                rgba(147, 197, 253, 0.25) 0%,
                rgba(147, 197, 253, 0.18) 20%,
                rgba(191, 219, 254, 0.12) 40%,
                rgba(191, 219, 254, 0.08) 60%,
                rgba(219, 234, 254, 0.04) 80%,
                transparent 100%
            );
            pointer-events: none;
            z-index: 1;
            opacity: 0;
            animation: fadeInGradient 0.5s ease-out 0s forwards;
        }
        
        /* About page styling */
        .about-white-card {
            background: #ffffff;
            padding: 40px;
            margin-bottom: 30px;
            border-radius: 8px;
        }
        
        .about-black-card {
            background: #000000;
            border: 2px solid #ffffff;
            padding: 40px;
            margin-bottom: 30px;
            border-radius: 8px;
        }
        
        /* Waitlist Section */
        .waitlist-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 40px 0;
        }
        
        .join-waitlist-btn {
            background: linear-gradient(135deg, #93C5FD 0%, #DBEAFE 100%);
            color: #000000;
            border: none;
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(147, 197, 253, 0.4);
        }
        
        .join-waitlist-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(147, 197, 253, 0.5);
        }
        
        .waitlist-form {
            margin-top: 20px;
            width: 100%;
            max-width: 300px;
        }
        
        .waitlist-form-content {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .waitlist-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #333;
            border-radius: 6px;
            background: #111;
            color: #ffffff;
            font-size: 14px;
        }
        
        .waitlist-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        
        .waitlist-input::placeholder {
            color: #666;
        }
        
        .waitlist-submit-btn {
            background: linear-gradient(135deg, #93C5FD 0%, #DBEAFE 100%);
            color: #000000;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(147, 197, 253, 0.3);
        }
        
        .waitlist-submit-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(147, 197, 253, 0.4);
        }
        
        .waitlist-cancel-btn {
            background: transparent;
            color: #93C5FD;
            border: 1px solid #93C5FD;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            width: 100%;
        }
        
        .waitlist-cancel-btn:hover {
            background: rgba(147, 197, 253, 0.1);
            border-color: #DBEAFE;
            color: #DBEAFE;
        }
        
        .waitlist-helper {
            font-size: 12px;
            color: #666;
            text-align: center;
            margin: 0;
        }
        
        /* Success/Error message styling for waitlist */
        .waitlist-helper.success {
            color: #10b981 !important;
        }
        
        .waitlist-helper.error {
            color: #ef4444 !important;
        }
        
        .waitlist-helper.warning {
            color: #f59e0b !important;
        }
        
        .waitlist-helper.info {
            color: #3b82f6 !important;
        }
        
        .hidden {
            display: none;
        }
        
        /* Billiard ball packaging design */
        .packaging-display {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 600px;
            max-height: 500px;
        }
        
        /* Central open box */
        .central-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 150px;
            background: #D2B48C;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 10;
        }
        
        .central-box::before {
            content: 'TruePhrase';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: #ffffff;
            font-weight: bold;
            font-size: 16px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        /* White insert with compartments */
        .box-insert {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            background: #ffffff;
            border-radius: 4px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 8px;
            padding: 8px;
        }
        
        /* Billiard balls */
        .billiard-ball {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            color: #ffffff;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .ball-yellow { background: #FFD700; color: #000000; }
        .ball-red { background: #DC143C; }
        .ball-orange { background: #FF8C00; }
        .ball-black { background: #000000; }
        
        /* Scattered closed boxes */
        .scattered-box {
            position: absolute;
            width: 80px;
            height: 60px;
            background: #D2B48C;
            border-radius: 6px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .scattered-box .box-number {
            width: 25px;
            height: 25px;
            background: #ffffff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            color: #000000;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        /* Box positions */
        .box-1 { top: 15%; left: 10%; }
        .box-2 { top: 25%; right: 15%; }
        .box-3 { top: 60%; left: 5%; }
        .box-4 { top: 70%; right: 20%; }
        .box-5 { top: 10%; left: 60%; }
        .box-6 { top: 80%; left: 40%; }
        .box-7 { top: 40%; right: 5%; }
        
        /* 3D TruePhrase text */
        .duet-3d-text {
            position: absolute;
            top: 20%;
            right: 10%;
            font-size: clamp(40px, 6vw, 80px);
            font-weight: 900;
            color: #4169E1;
            text-shadow: 
                3px 3px 0px #1E3A8A,
                6px 6px 0px #1E40AF,
                9px 9px 0px #1D4ED8;
            transform: rotate(-5deg);
            z-index: 5;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .split-homepage {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto;
            }
            
            .left-section, .right-section {
                padding: 20px;
            }
            
            .product-display {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Slinky-like 3D Ring Animation */
        .slinky-container {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 0 auto 2rem;
            perspective: 1200px;
            transform-style: preserve-3d;
        }
        
        .slinky-ring {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 4px solid;
            opacity: 0.8;
            transform-style: preserve-3d;
            animation: slinkyMotion 4s ease-in-out forwards;
            box-shadow: 
                0 8px 25px rgba(0,0,0,0.15),
                0 4px 12px rgba(0,0,0,0.1),
                inset 0 2px 4px rgba(255,255,255,0.3);
        }
        
        .slinky-ring-1 {
            border-color: #2196f3;
            background: linear-gradient(135deg, #64b5f6, #42a5f5);
            top: 50px;
            left: 170px;
            animation-delay: 0s;
        }
        
        .slinky-ring-2 {
            border-color: #1976d2;
            background: linear-gradient(135deg, #42a5f5, #2196f3);
            top: 120px;
            left: 120px;
            animation-delay: 0.2s;
        }
        
        .slinky-ring-3 {
            border-color: #1565c0;
            background: linear-gradient(135deg, #2196f3, #1976d2);
            top: 190px;
            left: 170px;
            animation-delay: 0.4s;
        }
        
        .slinky-ring-4 {
            border-color: #0d47a1;
            background: linear-gradient(135deg, #1976d2, #1565c0);
            top: 260px;
            left: 220px;
            animation-delay: 0.6s;
        }
        
        .slinky-ring-5 {
            border-color: #2196f3;
            background: linear-gradient(135deg, #64b5f6, #42a5f5);
            top: 330px;
            left: 170px;
            animation-delay: 0.8s;
        }
        
        .slinky-ring-6 {
            border-color: #1976d2;
            background: linear-gradient(135deg, #42a5f5, #2196f3);
            top: 260px;
            left: 120px;
            animation-delay: 1s;
        }
        
        .slinky-ring-7 {
            border-color: #1565c0;
            background: linear-gradient(135deg, #2196f3, #1976d2);
            top: 190px;
            left: 70px;
            animation-delay: 1.2s;
        }
        
        .slinky-ring-8 {
            border-color: #0d47a1;
            background: linear-gradient(135deg, #1976d2, #1565c0);
            top: 120px;
            left: 120px;
            animation-delay: 1.4s;
        }
        
        @keyframes slinkyMotion {
            0% {
                transform: translateZ(0px) rotateX(0deg) rotateY(0deg);
                opacity: 0.3;
            }
            25% {
                transform: translateZ(80px) rotateX(15deg) rotateY(45deg);
                opacity: 0.7;
            }
            50% {
                transform: translateZ(120px) rotateX(30deg) rotateY(90deg);
                opacity: 0.9;
            }
            75% {
                transform: translateZ(80px) rotateX(15deg) rotateY(135deg);
                opacity: 0.7;
            }
            100% {
                transform: translateZ(0px) rotateX(0deg) rotateY(180deg);
                opacity: 0.8;
            }
        }
        
        /* Shadow casting effect */
        .slinky-container::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200px;
            height: 100px;
            background: radial-gradient(ellipse at center, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.1) 40%, transparent 70%);
            transform: translate(-50%, -50%) rotateX(60deg) scaleY(0.5);
            filter: blur(8px);
            z-index: -1;
            animation: shadowMotion 4s ease-in-out forwards;
        }
        
        @keyframes shadowMotion {
            0% {
                opacity: 0.1;
                transform: translate(-50%, -50%) rotateX(60deg) scaleY(0.3) scaleX(0.8);
            }
            25% {
                opacity: 0.3;
                transform: translate(-50%, -50%) rotateX(60deg) scaleY(0.6) scaleX(1.2);
            }
            50% {
                opacity: 0.4;
                transform: translate(-50%, -50%) rotateX(60deg) scaleY(0.8) scaleX(1.5);
            }
            75% {
                opacity: 0.3;
                transform: translate(-50%, -50%) rotateX(60deg) scaleY(0.6) scaleX(1.2);
            }
            100% {
                opacity: 0.2;
                transform: translate(-50%, -50%) rotateX(60deg) scaleY(0.5) scaleX(1);
            }
        }
        
        /* Logo text */
        .logo-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 36px;
            font-weight: bold;
            color: #1976d2;
            text-shadow: 0 4px 8px rgba(0,0,0,0.2);
            opacity: 0;
            animation: fadeInLogo 1s ease-in-out 4s forwards;
            z-index: 10;
        }
        
        @keyframes fadeInLogo {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
        
        /* Generator Page Styling */
        .generator-page {
            height: 100vh;
            background: #000000;
            padding: 0;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            display: flex;
            flex-direction: row;
            z-index: 1000;
        }
        
        /* Chat Sidebar Styling */
        .chat-sidebar {
            width: 250px;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: relative;
            z-index: 100002;
            overflow: hidden;
            pointer-events: auto;
        }
        
        .sidebar-header {
            padding: 70px 20px 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            z-index: 100003;
            pointer-events: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .new-chat-button {
            width: 100%;
            padding: 12px 16px;
            background: linear-gradient(135deg, #93C5FD 0%, #DBEAFE 100%);
            color: #000000;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            z-index: 100004;
            pointer-events: auto;
        }
        
        .new-chat-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(147, 197, 253, 0.3);
        }
        
        .new-chat-button:active {
            transform: translateY(0);
        }
        
        .writing-samples-button {
            width: 100%;
            padding: 12px 16px;
            background: transparent;
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            z-index: 100004;
            pointer-events: auto;
        }
        
        .writing-samples-button:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.95);
            transform: translateY(-1px);
        }
        
        .writing-samples-button:active {
            transform: translateY(0);
        }
        
        .sidebar-chat-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .sidebar-chat-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .sidebar-chat-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }
        
        .sidebar-chat-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        
        .sidebar-chat-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .chat-item {
            padding: 12px;
            margin-bottom: 4px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
        }
        
        .chat-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.95);
        }
        
        .chat-item.active {
            background: rgba(147, 197, 253, 0.15);
            color: #93C5FD;
            border-left: 3px solid #93C5FD;
        }
        
        .chat-item-title {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 8px;
        }
        
        .chat-item-actions {
            display: none;
            gap: 4px;
        }
        
        .chat-item:hover .chat-item-actions {
            display: flex;
        }
        
        .chat-item-action-btn {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        
        .chat-item-action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
        }
        
        .chat-item-date {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.4);
            margin-top: 4px;
        }
        
        .sidebar-loading {
            padding: 20px;
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
        }
        
        .generator-content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        
        /* Writing Samples Page Styling */
        .writing-samples-page {
            height: 100vh;
            background: #000000;
            padding: 80px 40px 40px 40px;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .writing-samples-page::before {
            content: '';
            position: fixed;
            bottom: 0;
            right: 0;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(
                ellipse 80vw 60vh at bottom right,
                rgba(147, 197, 253, 0.25) 0%,
                rgba(147, 197, 253, 0.18) 20%,
                rgba(191, 219, 254, 0.12) 40%,
                rgba(191, 219, 254, 0.08) 60%,
                rgba(219, 234, 254, 0.04) 80%,
                transparent 100%
            );
            pointer-events: none;
            z-index: 0;
            opacity: 0;
            animation: fadeInGradient 0.5s ease-out 0s forwards;
        }
        
        .writing-samples-container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }
        
        .writing-samples-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .writing-samples-subtitle {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            margin-bottom: 40px;
        }
        
        .writing-samples-form {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 24px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
        }
        
        .form-textarea {
            width: 100%;
            min-height: 200px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #ffffff;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .form-textarea:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: #93C5FD;
            box-shadow: 0 0 0 3px rgba(147, 197, 253, 0.1);
        }
        
        .form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .form-button {
            width: 100%;
            padding: 14px 24px;
            background: linear-gradient(135deg, #93C5FD 0%, #DBEAFE 100%);
            color: #000000;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .form-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(147, 197, 253, 0.4);
        }
        
        .form-button:active {
            transform: translateY(0);
        }
        
        .samples-list {
            margin-top: 40px;
        }
        
        .sample-item {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 16px;
        }
        
        .sample-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .sample-item-date {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
        }
        
        .sample-item-delete {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.7);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .sample-item-delete:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: #ef4444;
            color: #ef4444;
        }
        
        .sample-item-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.5);
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        /* Responsive adjustments for mobile */
        @media (max-width: 768px) {
            .generator-page {
                flex-direction: column;
            }
            
            .chat-sidebar {
                width: 100%;
                height: auto;
                max-height: 40vh;
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
        }
        
        .generator-page::before {
            content: '';
            position: fixed;
            bottom: 0;
            right: 0;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(
                ellipse 80vw 60vh at bottom right,
                rgba(147, 197, 253, 0.25) 0%,
                rgba(147, 197, 253, 0.18) 20%,
                rgba(191, 219, 254, 0.12) 40%,
                rgba(191, 219, 254, 0.08) 60%,
                rgba(219, 234, 254, 0.04) 80%,
                transparent 100%
            );
            pointer-events: none;
            z-index: 0;
            opacity: 0;
            animation: fadeInGradient 0.5s ease-out 0s forwards;
        }
        
        .message-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            max-width: 600px;
            width: 90%;
        }
        
        .generator-header {
            text-align: center;
            padding: 80px 20px 20px 20px;
            position: relative;
            z-index: 10;
            flex-shrink: 0;
        }
        
        .generator-title {
            font-size: 2rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 8px;
            letter-spacing: -0.01em;
        }
        
        .generator-subtitle {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 400;
            margin: 0;
        }
        
        .generator-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 10;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        .generator-content {
            flex: 1;
            display: flex;
            gap: 20px;
            padding: 0 20px;
            overflow: auto;
        }
        
        .generator-input-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow: auto;
        }
        
        .generator-output-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: auto;
        }
        
        .generator-bottom {
            padding: 20px;
            position: relative;
            z-index: 10;
            flex-shrink: 0;
        }
        
        .input-panel, .output-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                0 4px 16px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: auto;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .input-panel::before, .output-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #94a3b8, #cbd5e1, #94a3b8);
            background-size: 200% 100%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        .chat-input-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 16px 20px;
            box-shadow: 
                0 8px 32px rgba(255, 255, 255, 0.1),
                0 4px 16px rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: flex-end;
            gap: 12px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }
        
        .chat-input {
            flex: 1;
            border: none;
            background: transparent;
            resize: none;
            font-size: 1rem;
            line-height: 1.5;
            max-height: 120px;
            min-height: 24px;
            outline: none;
            font-family: inherit;
            color: #ffffff;
        }
        
        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .chat-send-button {
            background: linear-gradient(135deg, #93C5FD 0%, #DBEAFE 100%);
            color: #000000;
            border: none;
            border-radius: 12px;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 48px;
            height: 48px;
        }
        
        .chat-send-button:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(147, 197, 253, 0.3);
        }
        
        /* Clear Chat Button */
        .clear-chat-button {
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .clear-chat-button:hover {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .chat-send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .panel-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.1);
        }
        
        .panel-icon {
            font-size: 2rem;
            margin-right: 15px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }
        
        .panel-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e293b;
            margin: 0;
            letter-spacing: -0.01em;
        }
        
        .input-section, .output-section {
            margin-bottom: 25px;
        }
        
        .input-label {
            display: flex;
            align-items: center;
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
            letter-spacing: 0.01em;
        }
        
        .label-icon {
            font-size: 1.25rem;
            margin-right: 8px;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
        }
        
        .modern-textarea {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid rgba(102, 126, 234, 0.1);
            border-radius: 16px;
            font-size: 1rem;
            font-family: inherit;
            line-height: 1.6;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            resize: none;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .modern-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 
                0 0 0 4px rgba(102, 126, 234, 0.1),
                inset 0 2px 4px rgba(0, 0, 0, 0.05);
            background: rgba(255, 255, 255, 0.95);
        }
        
        .modern-textarea::placeholder {
            color: #9ca3af;
            font-style: italic;
        }
        
        .output-textarea {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-color: rgba(102, 126, 234, 0.15);
        }
        
        .generate-button {
            width: 100%;
            padding: 16px 24px;
            background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 8px 20px rgba(148, 163, 184, 0.3),
                0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: auto;
            margin-top: 15px;
        }
        
        .generate-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 
                0 12px 25px rgba(148, 163, 184, 0.4),
                0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .generate-button:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .generate-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .copy-button {
            width: 100%;
            padding: 16px 24px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 8px 20px rgba(16, 185, 129, 0.3),
                0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .copy-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 
                0 12px 25px rgba(16, 185, 129, 0.4),
                0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .copy-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .copy-icon {
            font-size: 1.25rem;
        }
        
        .modern-spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: modernSpin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes modernSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .guidance-panel {
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.05) 0%, rgba(203, 213, 225, 0.05) 100%);
            border: 2px solid rgba(148, 163, 184, 0.1);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
        }
        
        .guidance-content {
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .guidance-icon {
            font-size: 2rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
            flex-shrink: 0;
        }
        
        .guidance-text {
            flex: 1;
        }
        
        .guidance-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1e293b;
            margin: 0 0 8px 0;
            letter-spacing: -0.01em;
        }
        
        .guidance-text p {
            font-size: 0.95rem;
            color: #4b5563;
            line-height: 1.6;
            margin: 0;
        }
        
        .guidance-text strong {
            color: #64748b;
            font-weight: 700;
        }
        
        /* Speech Bubble Styling - Cloud Style */
        .speech-bubble {
            background: #ffffff;
            border-radius: 25px 25px 25px 5px;
            padding: 20px;
            margin: 0;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                0 4px 16px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.05);
            position: relative;
            animation: fadeInUp 0.5s ease-out;
            max-width: 80%;
            margin-left: auto;
            margin-right: 0;
        }
        
        .speech-bubble.user {
            margin-left: auto;
            margin-right: 0;
            background: #f5f5f5;
            border-radius: 20px 20px 4px 20px;
            max-width: 70%;
            padding: 16px 20px;
        }
        
        .speech-bubble::before {
            content: '';
            position: absolute;
            bottom: -8px;
            right: 25px;
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-top: 12px solid #ffffff;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }
        
        .speech-bubble.user::before {
            display: none;
        }
        
        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            right: 23px;
            width: 0;
            height: 0;
            border-left: 14px solid transparent;
            border-right: 14px solid transparent;
            border-top: 14px solid rgba(0, 0, 0, 0.05);
        }
        
        .speech-bubble.user::after {
            display: none;
        }
        
        /* Compact user bubble styling */
        .speech-bubble.user .speech-bubble-header {
            margin-bottom: 8px;
            padding-bottom: 8px;
        }
        
        .speech-bubble.user .speech-bubble-content {
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        /* AI Response Container - White area on left */
        .ai-response-container {
            background: #ffffff;
            border-radius: 16px;
            padding: 24px;
            margin: 0;
            margin-right: auto;
            margin-left: 0;
            max-width: 75%;
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.08),
                0 2px 8px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(0, 0, 0, 0.06);
            animation: fadeInUp 0.4s ease-out;
            position: relative;
        }
        
        .ai-response-text {
            font-size: 1rem;
            line-height: 1.7;
            color: #1e293b;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 0;
        }
        
        .streaming-text {
            display: inline;
        }
        
        .typing-cursor {
            display: inline-block;
            width: 2px;
            height: 1.2em;
            background-color: #1e293b;
            animation: blink 1s infinite;
            margin-left: 2px;
            vertical-align: baseline;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .speech-bubble-content {
            font-size: 1rem;
            line-height: 1.6;
            color: #1e293b;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .speech-bubble-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }
        
        .speech-bubble-icon {
            font-size: 1.5rem;
            margin-right: 10px;
        }
        
        .speech-bubble-title {
            font-weight: 600;
            color: #374151;
            font-size: 0.9rem;
        }
        
        /* Tab Styling */
        .style-tab-container {
            margin-bottom: 15px;
        }
        
        .style-tab-button {
            background: rgba(148, 163, 184, 0.1);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 12px 12px 0 0;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            color: #64748b;
            width: 100%;
            text-align: left;
        }
        
        .style-tab-button:hover {
            background: rgba(148, 163, 184, 0.15);
            color: #475569;
        }
        
        .style-tab-button.active {
            background: rgba(255, 255, 255, 0.9);
            color: #1e293b;
            border-bottom: 1px solid rgba(255, 255, 255, 0.9);
            margin-bottom: -1px;
        }
        
        .style-tab-content {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-top: none;
            border-radius: 0 0 16px 16px;
            padding: 20px;
            display: none;
            animation: slideDown 0.3s ease-out;
        }
        
        .style-tab-content.active {
            display: block;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .tab-icon {
            font-size: 1rem;
            transition: transform 0.3s ease;
        }
        
        .style-tab-button.active .tab-icon {
            transform: rotate(180deg);
        }
        
        /* Chat Messages Container */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-messages::-webkit-scrollbar-track {
            background: rgba(148, 163, 184, 0.1);
            border-radius: 3px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: rgba(148, 163, 184, 0.3);
            border-radius: 3px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: rgba(148, 163, 184, 0.5);
        }
        
        /* Auto-scroll Lock Icon */
        .auto-scroll-lock {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #e2e8f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            font-size: 20px;
        }

        .auto-scroll-lock:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .auto-scroll-lock.enabled {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
            color: #3b82f6;
        }

        .auto-scroll-lock.enabled:hover {
            background: rgba(59, 130, 246, 0.2);
        }
        
        /* Hide auto-scroll lock on home and about pages */
        body:has(#view-home:not(.hidden)) .auto-scroll-lock,
        body:has(#view-about:not(.hidden)) .auto-scroll-lock {
            display: none;
        }
        
        /* Custom arrow for auto-scroll */
        .auto-scroll-arrow {
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 12px solid #3b82f6;
            transition: all 0.3s ease;
        }
        
        .auto-scroll-pause {
            width: 12px;
            height: 12px;
            background: #64748b;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .auto-scroll-pause::before,
        .auto-scroll-pause::after {
            content: '';
            position: absolute;
            width: 3px;
            height: 12px;
            background: white;
            top: 0;
        }
        
        .auto-scroll-pause::before {
            left: 2px;
        }
        
        .auto-scroll-pause::after {
            right: 2px;
        }
    </style>
</head>
<body>
    <!-- Top Navigation -->
    <nav class="top-nav">
        <button id="navHome" onclick="showView('home')" class="active">Home</button>
        <button id="navGenerate" onclick="showView('generator')" class="locked">Generate</button>
        <button id="navAbout" onclick="showView('about')">About</button>
    </nav>

    <!-- Single Column Homepage Layout -->
    <div id="view-home" class="centered-homepage">
        <div class="initial-content">
        <!-- Main Branding -->
        <div class="home-branding">
            <h1 class="main-brand" id="brandLogo">[]</h1>
            <div class="brand-definition" id="brandDef" style="display: none;">
                /'truËfreÉªz/ NOUN<br>
                AUTHENTIC AI-GENERATED TEXT THAT SOUNDS TRULY HUMAN
            </div>
            <p style="font-size: 14px; color: #93C5FD; margin-top: 20px; opacity: 0.8;">Powered by ChatGPT</p>
        </div>
        
        <!-- Join Waitlist Button -->
        <div class="waitlist-section-centered">
            <button onclick="toggleWaitlistForm()" class="join-waitlist-btn">
                Join the Waitlist
            </button>
            
            <!-- Waitlist Form (Hidden by default) -->
            <div id="waitlistForm" class="waitlist-form hidden">
                <form onsubmit="return submitWaitlist(event)" class="waitlist-form-content">
                    <input id="waitlistEmail" type="email" required placeholder="Enter your email" class="waitlist-input" />
                    <button type="submit" class="waitlist-submit-btn">Sign Up</button>
                </form>
                <p id="waitlistHelper" class="waitlist-helper">We respect your privacy. No spam, ever.</p>
                <button onclick="toggleWaitlistForm()" class="waitlist-cancel-btn">Cancel</button>
            </div>
        </div>
        
        <!-- What TruePhrase Does -->
        <div class="home-description">
            <p>TruePhrase generates AI text in your personal style that passes ZeroGPT and TurnItIn detection.</p>
        </div>
        
        <!-- Toggle Button for Development Info -->
        <button onclick="toggleDevelopmentInfo()" class="toggle-dev-button">Why Join the Waitlist?</button>
        </div>
        
        <!-- Development Status -->
        <div id="developmentStatus" class="development-status hidden">
            <div class="status-badge in-progress">In Development</div>
            <h3>Why Join the Waitlist?</h3>
            <p>TruePhrase is currently in active development. By joining our waitlist, you'll be among the first to:</p>
            <ul>
                <li>Receive exclusive updates on our development progress</li>
                <li>Get early access when we launch</li>
                <li>Shape the future of AI text generation with your feedback</li>
            </ul>
        </div>
    </div>

        <!-- Generator View -->
        <div id="view-generator" class="hidden generator-page">
            <!-- Chat Sidebar -->
            <div class="chat-sidebar">
                <div class="sidebar-header">
                    <button id="newChatBtn" onclick="createNewChat(event)" class="new-chat-button">
                        <span>+</span>
                        <span>New Chat</span>
                    </button>
                    <button id="writingSamplesBtn" onclick="showView('writing-samples')" class="writing-samples-button">
                        <span>ðŸ“</span>
                        <span>Writing Samples</span>
                    </button>
                </div>
                <div class="sidebar-chat-list" id="sidebarChatList">
                    <div class="sidebar-loading" id="sidebarLoading">Loading chats...</div>
                </div>
            </div>
            
            <!-- Generator Content Wrapper -->
            <div class="generator-content-wrapper">
                <!-- Message Container -->
                <div id="messageContainer" class="message-container"></div>
                
                <!-- Main Content Area -->
                <div class="generator-main">
                    <!-- Chat Messages Area -->
                    <div class="chat-messages" id="chatMessages">
                        <!-- Messages will appear here -->
                    </div>
                    
                </div>
                
                <!-- Bottom Input Area (ChatGPT Style) -->
                <div class="generator-bottom">
                    <div class="chat-input-container">
                        <textarea 
                            id="prompt" 
                            class="chat-input"
                            placeholder="Enter a prompt to generate AI text (e.g., 'Write a blog post about artificial intelligence')..."
                            rows="1"
                        ></textarea>
                        <button 
                            id="generateBtn" 
                            onclick="generateText()"
                            class="chat-send-button"
                        >
                            <span id="generateBtnText">â†’</span>
                            <div id="generateSpinner" class="modern-spinner hidden"></div>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Writing Samples View -->
        <div id="view-writing-samples" class="hidden writing-samples-page">
            <div class="writing-samples-container">
                <h1 class="writing-samples-title">Writing Samples</h1>
                <p class="writing-samples-subtitle">Add your writing samples to help TruePhrase learn your personal style</p>
                
                <div class="writing-samples-form">
                    <form onsubmit="return addWritingSample(event)">
                        <div class="form-group">
                            <label class="form-label" for="sampleText">Paste your writing sample here:</label>
                            <textarea 
                                id="sampleText" 
                                class="form-textarea"
                                placeholder="Paste a piece of your writing (essay, email, article, etc.) to help the AI understand your writing style..."
                                required
                            ></textarea>
                        </div>
                        <button type="submit" class="form-button">Add Sample</button>
                    </form>
                </div>
                
                <div class="samples-list" id="samplesList">
                    <!-- Samples will be displayed here -->
                </div>
            </div>
        </div>

        <!-- About View -->
        <div id="view-about" class="hidden about-page-with-gradient" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; height: 100vh; background: #000000; z-index: 1000; overflow-y: auto;">
            <div style="padding: 80px 40px 40px 40px; text-align: center; min-height: 100vh; display: flex; flex-direction: column; justify-content: flex-start;">
                <h1 style="font-size: 36px; color: #ffffff; margin-bottom: 30px; font-weight: 800;">About TruePhrase</h1>
                
                <div style="max-width: 700px; margin: 0 auto; text-align: center;">
                    <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); padding: 30px; margin-bottom: 25px; border-radius: 12px;">
                        <h2>How It Works</h2>
                        <p style="font-size: 15px; color: #DBEAFE; line-height: 1.6;">
                            Give our AI a prompt and it generates high-quality, natural-sounding text.
                        </p>
                        <ul style="list-style: none; padding: 0; font-size: 15px; text-align: left; display: inline-block; line-height: 1.8; margin-top: 10px;">
                            <li style="padding-left: 25px; position: relative; margin-bottom: 12px;">Understands context, tone, and style</li>
                            <li style="padding-left: 25px; position: relative; margin-bottom: 12px;">Mimics your personal writing style from samples</li>
                            <li style="padding-left: 25px; position: relative; margin-bottom: 12px;">Passes AI detection tools like ZeroGPT and TurnItIn</li>
                        </ul>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); padding: 30px; margin-bottom: 25px; border-radius: 12px;">
                        <h2>How You Can Use TruePhrase</h2>
                        <p style="font-size: 15px; color: #DBEAFE; line-height: 1.6;">
                            Use TruePhrase for all your writing needs, from academic to professional.
                        </p>
                        <ul style="list-style: none; padding: 0; font-size: 15px; color: #ffffff; text-align: left; display: inline-block; line-height: 1.8; margin-top: 10px;">
                            <li style="padding-left: 25px; position: relative; margin-bottom: 12px; color: #DBEAFE; font-weight: 500;">Writing assignments and essays</li>
                            <li style="padding-left: 25px; position: relative; margin-bottom: 12px; color: #DBEAFE; font-weight: 500;">Creating resumes and cover letters</li>
                            <li style="padding-left: 25px; position: relative; margin-bottom: 12px; color: #DBEAFE; font-weight: 500;">Drafting emails and business communications</li>
                        </ul>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); padding: 30px; margin-bottom: 25px; border-radius: 12px;">
                        <h2>Our Team</h2>
                        <p style="font-size: 15px; color: #DBEAFE; line-height: 1.6;">
                            We're a small team of developers, writers, and AI enthusiasts who believe that good writing shouldn't be a barrier to sharing ideas. We've fine-tuned our AI to be genuinely helpful, built for bloggers, marketers, students, and content creators, and focused on removing barriers to sharing ideas.
                        </p>
                    </div>
                    
                    <p style="font-size: 14px; color: #ffffff; margin-top: 30px; text-align: center; font-style: italic;">
                        Currently in development. Join our waitlist to be the first to try it out!
                    </p>
                </div>
            </div>
        </div>

    <!-- Auto-scroll Lock Toggle -->
    <div id="autoScrollLock" class="auto-scroll-lock enabled" onclick="toggleAutoScroll()">
        <div class="auto-scroll-arrow"></div>
    </div>

    <script>
        const apiKey = "AIzaSyAh_svSVAhXGG-3RhSd9H_a6acf8rc5w5Q";
        const maxRetries = 3;
        const baseDelay = 1000;
        
        // Conversation history array - stores all prompts and responses
        // Format: [{ role: 'user', text: '...' }, { role: 'model', text: '...' }]
        let conversationHistory = [];
        
        // Current chat ID - tracks the active chat in Supabase
        let currentChatId = null;
        
        // Auto-scroll state management
        let autoScrollEnabled = true;
        
        // Secret key combination state
        let secretKeySequence = [];
        const secretKey = ['KeyT', 'KeyB', 'Digit4', 'Digit0', 'Digit4', 'Digit1', 'Digit1', 'Digit0'];
        let isGeneratorUnlocked = false;
        
        // Typewriter animation state
        let typewriterTimer = null;
        
        // Toggle auto-scroll lock
        function toggleAutoScroll() {
            autoScrollEnabled = !autoScrollEnabled;
            const lockIcon = document.getElementById('autoScrollLock');
            
            if (autoScrollEnabled) {
                lockIcon.innerHTML = '<div class="auto-scroll-arrow"></div>';
                lockIcon.classList.add('enabled');
                // Scroll to bottom when enabling auto-scroll
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages) {
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            } else {
                lockIcon.innerHTML = '<div class="auto-scroll-pause"></div>';
                lockIcon.classList.remove('enabled');
            }
        }
        
        // Simple SPA view switcher
        function showView(view) {
            // Check if trying to access generator while locked
            if (view === 'generator' && !isGeneratorUnlocked) {
                alert('We apologize, but the AI text generator is currently in development. Please join our waitlist on the homepage for updates on when it will be available, and follow our social media for the latest news!');
                return;
            }
            
            const home = document.getElementById('view-home');
            const gen = document.getElementById('view-generator');
            const about = document.getElementById('view-about');
            const writingSamples = document.getElementById('view-writing-samples');
            const navHome = document.getElementById('navHome');
            const navGenerate = document.getElementById('navGenerate');
            const navAbout = document.getElementById('navAbout');

            // Hide all views
            home.classList.add('hidden');
            gen.classList.add('hidden');
            about.classList.add('hidden');
            if (writingSamples) writingSamples.classList.add('hidden');
            
            // Remove active class from all nav buttons
            navHome.classList.remove('active');
            navGenerate.classList.remove('active');
            navAbout.classList.remove('active');

            // Show selected view and activate corresponding nav button
            if (view === 'home') {
                home.classList.remove('hidden');
                navHome.classList.add('active');
                // Trigger typewriter effect when switching to home
                typeWriterLogo();
            } else if (view === 'generator') {
                gen.classList.remove('hidden');
                navGenerate.classList.add('active');
                // Set up Enter key handler for prompt textarea when generator view is shown
                setupPromptEnterHandler();
                // Load chats from Supabase when generator view is shown
                loadChatsFromSupabase();
                // Ensure New Chat button is clickable
                setTimeout(() => {
                    const newChatBtn = document.getElementById('newChatBtn');
                    if (newChatBtn) {
                        // Add event listener as backup (onclick in HTML should work, but this ensures it)
                        newChatBtn.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            console.log('New Chat button clicked (via event listener)');
                            createNewChat(e);
                        }, { capture: true, passive: false });
                        console.log('New Chat button setup complete');
                    } else {
                        console.error('New Chat button not found!');
                    }
                }, 100);
            } else if (view === 'writing-samples') {
                const writingSamples = document.getElementById('view-writing-samples');
                if (writingSamples) {
                    writingSamples.classList.remove('hidden');
                }
                // Load and display existing samples
                loadWritingSamples();
            } else if (view === 'about') {
                about.classList.remove('hidden');
                navAbout.classList.add('active');
            }
            
            // Clear messages on view switch
            document.getElementById('messageContainer').innerHTML = '';
        }

        // Toggle waitlist form visibility
        function toggleWaitlistForm() {
            const form = document.getElementById('waitlistForm');
            const button = document.querySelector('.join-waitlist-btn');
            
            if (form.classList.contains('hidden')) {
                form.classList.remove('hidden');
                button.classList.add('hidden');
            } else {
                form.classList.add('hidden');
                button.classList.remove('hidden');
                // Clear form and messages
                document.getElementById('waitlistEmail').value = '';
                document.getElementById('waitlistHelper').textContent = 'We respect your privacy. No spam, ever.';
                document.getElementById('waitlistHelper').className = 'waitlist-helper';
            }
        }
        
        // Toggle development info section
        function toggleDevelopmentInfo() {
            const status = document.getElementById('developmentStatus');
            const homepage = document.getElementById('view-home');
            if (!status || !homepage) return;
            
            if (status.classList.contains('hidden')) {
                status.classList.remove('hidden');
                // Extend the homepage height
                homepage.classList.add('extended');
                // Scroll to the bottom of the page with smooth behavior after extension completes
                setTimeout(() => {
                    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                }, 300.1);
            } else {
                status.classList.add('hidden');
                // Shrink the homepage back to normal
                homepage.classList.remove('extended');
            }
        }

        // Add speech bubble to chat - user on right, AI on left
        function addSpeechBubble(content, isUser = false) {
            const chatMessages = document.getElementById('chatMessages');
            const bubble = document.createElement('div');
            bubble.className = `speech-bubble ${isUser ? 'user' : ''}`;
            
            if (isUser) {
                // User bubbles: no header, just content
                bubble.innerHTML = `
                    <div class="speech-bubble-content">${content}</div>
                `;
            } else {
                // AI bubbles: with header
                bubble.innerHTML = `
                    <div class="speech-bubble-header">
                        <span class="speech-bubble-icon"></span>
                        <span class="speech-bubble-title">TruePhrase AI</span>
                    </div>
                    <div class="speech-bubble-content">${content}</div>
                `;
            }
            
            chatMessages.appendChild(bubble);
            
            // Only auto-scroll if enabled
            if (autoScrollEnabled) {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            return bubble;
        }
        
        // Add streaming AI response container (left side, white background)
        function addStreamingBubble() {
            const chatMessages = document.getElementById('chatMessages');
            const containerDiv = document.createElement('div');
            containerDiv.className = 'ai-response-container';
            
            const textDiv = document.createElement('div');
            textDiv.className = 'ai-response-text';
            
            const streamingSpan = document.createElement('span');
            streamingSpan.className = 'streaming-text';
            const cursor = document.createElement('span');
            cursor.className = 'typing-cursor';
            
            textDiv.appendChild(streamingSpan);
            textDiv.appendChild(cursor);
            containerDiv.appendChild(textDiv);
            chatMessages.appendChild(containerDiv);
            
            if (autoScrollEnabled) {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            return streamingSpan;
        }
        
        // Update streaming text
        function updateStreamingText(element, text) {
            element.textContent = text;
            
            // Only auto-scroll if enabled and user is at the absolute bottom
            if (autoScrollEnabled) {
                const chatMessages = document.getElementById('chatMessages');
                const isAtBottom = chatMessages.scrollTop + chatMessages.clientHeight >= chatMessages.scrollHeight - 5;
                
                if (isAtBottom) {
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            }
        }
        
        // Finish streaming (remove cursor)
        function finishStreaming() {
            const cursor = document.querySelector('.typing-cursor');
            if (cursor) {
                cursor.remove();
            }
        }

        // Waitlist submission with Supabase
        async function submitWaitlist(e) {
            e.preventDefault();
            const email = document.getElementById('waitlistEmail').value.trim();
            const helper = document.getElementById('waitlistHelper');
            
            // Basic email validation
            const valid = /.+@.+\..+/.test(email);
            if (!valid) {
                helper.textContent = 'Please enter a valid email address.';
                helper.className = 'waitlist-helper error';
                return false;
            }

            try {
                // Show loading state
                helper.textContent = 'Adding to waitlist...';
                helper.className = 'waitlist-helper info';

                // Debug: Check if supabaseClient is available
                if (!supabaseClient) {
                    throw new Error('Supabase client not initialized');
                }

                console.log('Attempting to insert email:', email);
                console.log('Supabase client:', supabaseClient);

                // Insert email into Supabase
                const { data, error } = await supabaseClient
                    .from('waitlist')
                    .insert([
                        { email: email }
                    ])
                    .select();

                if (error) {
                    if (error.code === '23505') {
                        // Duplicate email error
                        helper.textContent = 'This email is already on our waitlist!';
                        helper.className = 'waitlist-helper warning';
                    } else {
                        throw error;
                    }
                } else {
                    // Success
                    helper.textContent = 'Successfully added to waitlist! We\'ll be in touch soon.';
                    helper.className = 'waitlist-helper success';
                    document.getElementById('waitlistEmail').value = '';
                }
            } catch (error) {
                console.error('Error adding to waitlist:', error);
                helper.textContent = 'Sorry, there was an error. Please try again.';
                helper.className = 'waitlist-helper error';
            }
            
            return false;
        }


        function showMessage(message, type = 'error') {
            const container = document.getElementById('messageContainer');
            const messageDiv = document.createElement('div');
            
            const bgColor = type === 'error' ? 'bg-red-500' : 'bg-green-500';
            const borderColor = type === 'error' ? 'border-red-400' : 'border-green-400';
            
            messageDiv.className = `${bgColor} ${borderColor} border-l-4 p-4 rounded-lg shadow-lg fade-in`;
            messageDiv.innerHTML = `
                <div class="flex items-center">
                    <div class="flex-1">
                        <p class="text-white font-medium">${message}</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </button>
                </div>
            `;
            
            container.appendChild(messageDiv);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 5000);
        }

        function setGenerateLoadingState(loading) {
            const btn = document.getElementById('generateBtn');
            const btnText = document.getElementById('generateBtnText');
            const spinner = document.getElementById('generateSpinner');
            
            if (loading) {
                btn.disabled = true;
                btnText.classList.add('hidden');
                spinner.classList.remove('hidden');
            } else {
                btn.disabled = false;
                btnText.classList.remove('hidden');
                spinner.classList.add('hidden');
            }
        }
        
        /**
         * Converts conversationHistory array to Gemini API format
         * @returns {Array} Array of content objects in Gemini API format
         */
        function formatConversationForAPI() {
            return conversationHistory.map(msg => ({
                role: msg.role === 'user' ? 'user' : 'model',
                parts: [{ text: msg.text }]
            }));
        }
        
        /**
         * Clears the conversation history and UI
         */
        function clearChat() {
            if (conversationHistory.length === 0) {
                // No conversation to clear
                return;
            }
            
            conversationHistory = [];
            currentChatId = null;
            document.getElementById('chatMessages').innerHTML = '';
            updateSidebarActiveState();
            console.log('Conversation cleared');
            showMessage('Chat cleared', 'success');
        }
        
        /**
         * Chat Management Functions with Supabase
         * 
         * REQUIRED SUPABASE TABLE STRUCTURE:
         * Create a table named 'chats' with the following columns:
         * - id: uuid, primary key, default: gen_random_uuid()
         * - title: text, not null
         * - messages: jsonb, not null
         * - created_at: timestamp with time zone, default: now()
         * - updated_at: timestamp with time zone, default: now()
         * 
         * SQL to create the table:
         * CREATE TABLE chats (
         *   id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
         *   title TEXT NOT NULL,
         *   messages JSONB NOT NULL,
         *   created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
         *   updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
         * );
         * 
         * Enable Row Level Security (RLS) if needed for your use case.
         */
        
        /**
         * Generates a title from the first user message
         * @param {Array} messages - Array of conversation messages
         * @returns {string} Generated title
         */
        function generateChatTitle(messages) {
            if (!messages || messages.length === 0) {
                return 'New Chat';
            }
            
            // Find first user message
            const firstUserMessage = messages.find(msg => msg.role === 'user');
            if (!firstUserMessage) {
                return 'New Chat';
            }
            
            // Take first 50 characters and clean up
            let title = firstUserMessage.text.trim();
            if (title.length > 50) {
                title = title.substring(0, 50) + '...';
            }
            return title || 'New Chat';
        }
        
        /**
         * Saves or updates a chat in Supabase
         * @param {string} chatId - Chat ID (null for new chat)
         * @param {Array} messages - Array of messages to save
         * @param {string} title - Optional title (will be generated if not provided)
         */
        async function saveChatToSupabase(chatId = null, messages = null, title = null) {
            if (!supabaseClient) {
                console.error('Supabase client not initialized');
                return null;
            }
            
            // Use current conversation if messages not provided
            const messagesToSave = messages || conversationHistory;
            
            // Generate title if not provided
            const chatTitle = title || generateChatTitle(messagesToSave);
            
            try {
                if (chatId) {
                    // Update existing chat
                    const { data, error } = await supabaseClient
                        .from('chats')
                        .update({
                            title: chatTitle,
                            messages: messagesToSave,
                            updated_at: new Date().toISOString()
                        })
                        .eq('id', chatId)
                        .select()
                        .single();
                    
                    if (error) throw error;
                    console.log('Chat updated:', data.id);
                    return data.id;
                } else {
                    // Create new chat
                    const { data, error } = await supabaseClient
                        .from('chats')
                        .insert([{
                            title: chatTitle,
                            messages: messagesToSave,
                            created_at: new Date().toISOString(),
                            updated_at: new Date().toISOString()
                        }])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    console.log('Chat created:', data.id);
                    return data.id;
                }
            } catch (error) {
                console.error('Error saving chat to Supabase:', error);
                showMessage('Failed to save chat. Please try again.', 'error');
                return null;
            }
        }
        
        /**
         * Loads all chats from Supabase and populates the sidebar
         */
        async function loadChatsFromSupabase() {
            if (!supabaseClient) {
                console.error('Supabase client not initialized');
                document.getElementById('sidebarLoading').textContent = 'Error: Supabase not connected';
                return;
            }
            
            try {
                const { data, error } = await supabaseClient
                    .from('chats')
                    .select('id, title, messages, created_at, updated_at')
                    .order('updated_at', { ascending: false });
                
                if (error) throw error;
                
                // Hide loading message
                document.getElementById('sidebarLoading').style.display = 'none';
                
                // Render chats in sidebar
                renderChatSidebar(data || []);
            } catch (error) {
                console.error('Error loading chats:', error);
                document.getElementById('sidebarLoading').textContent = 'Error loading chats';
            }
        }
        
        /**
         * Renders the chat list in the sidebar
         * @param {Array} chats - Array of chat objects from Supabase
         */
        function renderChatSidebar(chats) {
            const sidebarList = document.getElementById('sidebarChatList');
            
            // Clear existing content (except loading indicator which we hide)
            const loadingEl = document.getElementById('sidebarLoading');
            if (loadingEl) loadingEl.style.display = 'none';
            
            // Clear all chat items
            const existingChats = sidebarList.querySelectorAll('.chat-item');
            existingChats.forEach(item => item.remove());
            
            if (chats.length === 0) {
                sidebarList.innerHTML = '<div class="sidebar-loading">No chats yet. Start a new conversation!</div>';
                return;
            }
            
            // Render each chat
            chats.forEach(chat => {
                const chatItem = document.createElement('div');
                chatItem.className = 'chat-item';
                chatItem.dataset.chatId = chat.id;
                
                // Format date
                const date = new Date(chat.updated_at || chat.created_at);
                const dateStr = date.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric',
                    year: date.getFullYear() !== new Date().getFullYear() ? 'numeric' : undefined
                });
                
                chatItem.innerHTML = `
                    <div style="flex: 1; min-width: 0;">
                        <div class="chat-item-title">${escapeHtml(chat.title || 'Untitled Chat')}</div>
                        <div class="chat-item-date">${dateStr}</div>
                    </div>
                    <div class="chat-item-actions">
                        <button class="chat-item-action-btn" onclick="event.stopPropagation(); renameChat('${chat.id}', '${escapeHtml(chat.title)}')" title="Rename">
                            âœï¸
                        </button>
                        <button class="chat-item-action-btn" onclick="event.stopPropagation(); deleteChat('${chat.id}')" title="Delete">
                            ðŸ—‘ï¸
                        </button>
                    </div>
                `;
                
                // Click handler to load chat
                chatItem.addEventListener('click', () => {
                    loadChatFromSupabase(chat.id);
                });
                
                sidebarList.appendChild(chatItem);
            });
            
            // Update active state
            updateSidebarActiveState();
        }
        
        /**
         * Updates the active state of chat items in sidebar
         */
        function updateSidebarActiveState() {
            const chatItems = document.querySelectorAll('.chat-item');
            chatItems.forEach(item => {
                if (item.dataset.chatId === currentChatId) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }
        
        /**
         * Loads a specific chat from Supabase
         * @param {string} chatId - Chat ID to load
         */
        async function loadChatFromSupabase(chatId) {
            if (!supabaseClient) {
                console.error('Supabase client not initialized');
                return;
            }
            
            try {
                const { data, error } = await supabaseClient
                    .from('chats')
                    .select('*')
                    .eq('id', chatId)
                    .single();
                
                if (error) throw error;
                
                // Set current chat ID
                currentChatId = chatId;
                
                // Load messages into conversation history
                conversationHistory = data.messages || [];
                
                // Clear and render messages in UI
                const chatMessages = document.getElementById('chatMessages');
                chatMessages.innerHTML = '';
                
                // Render all messages
                conversationHistory.forEach((msg, index) => {
                    if (msg.role === 'user') {
                        addSpeechBubble(msg.text, true);
                    } else if (msg.role === 'model') {
                        // Create AI response container
                        const containerDiv = document.createElement('div');
                        containerDiv.className = 'ai-response-container';
                        const textDiv = document.createElement('div');
                        textDiv.className = 'ai-response-text';
                        textDiv.textContent = msg.text;
                        containerDiv.appendChild(textDiv);
                        chatMessages.appendChild(containerDiv);
                    }
                });
                
                // Scroll to bottom
                if (autoScrollEnabled) {
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
                
                // Update sidebar active state
                updateSidebarActiveState();
                
                console.log('Chat loaded:', chatId);
            } catch (error) {
                console.error('Error loading chat:', error);
                showMessage('Failed to load chat. Please try again.', 'error');
            }
        }
        
        /**
         * Creates a new chat (clears current and starts fresh)
         */
        async function createNewChat(event) {
            // Prevent any event propagation
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            try {
                console.log('createNewChat called. Current chat ID:', currentChatId, 'History length:', conversationHistory.length);
                
                // Save current chat if it has messages
                if (conversationHistory.length > 0) {
                    try {
                        if (currentChatId) {
                            // Update existing chat
                            await saveChatToSupabase(currentChatId);
                        } else {
                            // Create new chat from current conversation
                            const savedChatId = await saveChatToSupabase(null);
                            if (savedChatId) {
                                currentChatId = savedChatId;
                            }
                        }
                        // Reload sidebar to show the saved chat
                        await loadChatsFromSupabase();
                    } catch (saveError) {
                        console.error('Error saving chat before creating new one:', saveError);
                        // Continue anyway to clear the chat
                    }
                }
                
                // Clear current chat
                currentChatId = null;
                conversationHistory = [];
                document.getElementById('chatMessages').innerHTML = '';
                document.getElementById('prompt').value = '';
                updateSidebarActiveState();
                
                // Focus on input
                const promptInput = document.getElementById('prompt');
                if (promptInput) {
                    promptInput.focus();
                }
                
                console.log('New chat created successfully');
            } catch (error) {
                console.error('Error in createNewChat:', error);
                showMessage('Failed to create new chat. Please try again.', 'error');
            }
        }
        
        /**
         * Deletes a chat from Supabase
         * @param {string} chatId - Chat ID to delete
         */
        async function deleteChat(chatId) {
            if (!confirm('Are you sure you want to delete this chat?')) {
                return;
            }
            
            if (!supabaseClient) {
                console.error('Supabase client not initialized');
                return;
            }
            
            try {
                const { error } = await supabaseClient
                    .from('chats')
                    .delete()
                    .eq('id', chatId);
                
                if (error) throw error;
                
                // If deleted chat was the current one, clear it
                if (currentChatId === chatId) {
                    currentChatId = null;
                    conversationHistory = [];
                    document.getElementById('chatMessages').innerHTML = '';
                }
                
                // Reload sidebar
                await loadChatsFromSupabase();
                showMessage('Chat deleted', 'success');
            } catch (error) {
                console.error('Error deleting chat:', error);
                showMessage('Failed to delete chat. Please try again.', 'error');
            }
        }
        
        /**
         * Renames a chat
         * @param {string} chatId - Chat ID to rename
         * @param {string} currentTitle - Current title
         */
        async function renameChat(chatId, currentTitle) {
            const newTitle = prompt('Enter new chat title:', currentTitle);
            if (!newTitle || newTitle.trim() === '') {
                return;
            }
            
            if (!supabaseClient) {
                console.error('Supabase client not initialized');
                return;
            }
            
            try {
                const { error } = await supabaseClient
                    .from('chats')
                    .update({
                        title: newTitle.trim(),
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', chatId);
                
                if (error) throw error;
                
                // Reload sidebar
                await loadChatsFromSupabase();
                showMessage('Chat renamed', 'success');
            } catch (error) {
                console.error('Error renaming chat:', error);
                showMessage('Failed to rename chat. Please try again.', 'error');
            }
        }
        
        /**
         * Utility function to escape HTML
         */
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        /**
         * Writing Samples Management Functions
         */
        
        /**
         * Adds a new writing sample
         */
        function addWritingSample(event) {
            event.preventDefault();
            const sampleText = document.getElementById('sampleText').value.trim();
            
            if (!sampleText) {
                alert('Please enter a writing sample.');
                return false;
            }
            
            // Get existing samples from localStorage
            let samples = JSON.parse(localStorage.getItem('writingSamples') || '[]');
            
            // Add new sample
            const newSample = {
                id: Date.now().toString(),
                text: sampleText,
                date: new Date().toISOString()
            };
            
            samples.unshift(newSample); // Add to beginning
            
            // Save to localStorage
            localStorage.setItem('writingSamples', JSON.stringify(samples));
            
            // Clear form
            document.getElementById('sampleText').value = '';
            
            // Reload samples display
            loadWritingSamples();
            
            return false;
        }
        
        /**
         * Loads and displays all writing samples
         */
        function loadWritingSamples() {
            const samplesList = document.getElementById('samplesList');
            if (!samplesList) return;
            
            // Get samples from localStorage
            const samples = JSON.parse(localStorage.getItem('writingSamples') || '[]');
            
            // Clear existing display
            samplesList.innerHTML = '';
            
            if (samples.length === 0) {
                samplesList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“</div>
                        <p>No writing samples yet. Add your first sample above!</p>
                    </div>
                `;
                return;
            }
            
            // Display each sample
            samples.forEach(sample => {
                const sampleItem = document.createElement('div');
                sampleItem.className = 'sample-item';
                
                const date = new Date(sample.date);
                const dateStr = date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Extract first sentence or first 100 characters
                let preview = sample.text.trim();
                // Try to get first sentence (ends with ., !, or ?)
                const firstSentenceMatch = preview.match(/^[^.!?]+[.!?]/);
                if (firstSentenceMatch) {
                    preview = firstSentenceMatch[0].trim();
                } else if (preview.length > 100) {
                    // If no sentence ending found, truncate at 100 chars
                    preview = preview.substring(0, 100).trim() + '...';
                }
                
                sampleItem.innerHTML = `
                    <div class="sample-item-header">
                        <span class="sample-item-date">${dateStr}</span>
                        <button class="sample-item-delete" onclick="deleteWritingSample('${sample.id}')">Delete</button>
                    </div>
                    <div class="sample-item-content">${escapeHtml(preview)}</div>
                `;
                
                samplesList.appendChild(sampleItem);
            });
        }
        
        /**
         * Deletes a writing sample
         */
        function deleteWritingSample(sampleId) {
            if (!confirm('Are you sure you want to delete this writing sample?')) {
                return;
            }
            
            // Get existing samples
            let samples = JSON.parse(localStorage.getItem('writingSamples') || '[]');
            
            // Remove the sample
            samples = samples.filter(sample => sample.id !== sampleId);
            
            // Save back to localStorage
            localStorage.setItem('writingSamples', JSON.stringify(samples));
            
            // Reload display
            loadWritingSamples();
        }

        async function generateText() {
            console.log('generateText function called');
            const prompt = document.getElementById('prompt').value.trim();
            
            console.log('Prompt:', prompt);
            
            // Validation
            if (!prompt) {
                showMessage('Please enter a prompt to generate text.', 'error');
                return;
            }

            if (!apiKey) {
                showMessage('API key is required. Please add your Gemini API key to the code.', 'error');
                return;
            }

            console.log('Starting generation...');
            setGenerateLoadingState(true);
            
            // Clear error messages only, not the chat
            document.getElementById('messageContainer').innerHTML = '';
            
            // Add user prompt to conversation history
            conversationHistory.push({
                role: 'user',
                text: prompt
            });
            
            // Add user message to chat UI (bubble on right) - append, don't clear
            addSpeechBubble(prompt, true);
            
            // Clear the prompt input
            document.getElementById('prompt').value = '';
            
            try {
                console.log('Generating text with conversation history:', conversationHistory.length, 'messages');
                
                // System instruction for the AI
                const generateSystemInstruction = "You are a professional content writer who creates high-quality, engaging text based on user prompts. Write clear, well-structured content that is informative and engaging.";
                
                // Build payload with full conversation history
                const generatePayload = {
                    contents: formatConversationForAPI(),
                    systemInstruction: {
                        parts: [{
                            text: generateSystemInstruction
                        }]
                    }
                };

                // Create streaming text display - append new response
                const streamingElement = addStreamingBubble();
                
                // Call API with full conversation context
                const finalText = await makeApiCallWithRetry(generatePayload);
                
                // Add AI response to conversation history
                conversationHistory.push({
                    role: 'model',
                    text: finalText.trim()
                });
                
                // Simulate streaming by adding text character by character
                let currentText = '';
                for (let i = 0; i < finalText.length; i++) {
                    currentText += finalText[i];
                    updateStreamingText(streamingElement, currentText);
                    await new Promise(resolve => setTimeout(resolve, 20)); // 20ms delay between characters
                }
                
                console.log('Generation complete. Conversation history now has', conversationHistory.length, 'messages');
                finishStreaming();
                
                // Save chat to Supabase (create new if no currentChatId, update if exists)
                const savedChatId = await saveChatToSupabase(currentChatId);
                if (savedChatId) {
                    if (!currentChatId) {
                        // New chat was created, set as current
                        currentChatId = savedChatId;
                    }
                    // Reload sidebar to update timestamps and order
                    await loadChatsFromSupabase();
                    updateSidebarActiveState();
                }
                
                showMessage('Text generated successfully!', 'success');
                
            } catch (error) {
                console.error('Error:', error);
                showMessage(`Failed to generate text: ${error.message}`, 'error');
                
                // Remove the user message from history if API call failed
                conversationHistory.pop();
                
                // Show error in chat
                const errorText = document.createElement('div');
                errorText.style.cssText = 'text-align: center; padding: 20px; color: #ef4444; font-size: 1rem; line-height: 1.6;';
                errorText.textContent = 'Sorry, I encountered an error while generating your text. Please try again.';
                document.getElementById('chatMessages').appendChild(errorText);
            } finally {
                setGenerateLoadingState(false);
            }
        }


        async function makeApiCallWithRetry(payload) {
            let lastError;
            
            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    const response = await fetch(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`,
                        {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(payload)
                        }
                    );

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(`API request failed: ${response.status} ${response.statusText}. ${errorData.error?.message || ''}`);
                    }

                    const data = await response.json();
                    
                    if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                        throw new Error('Invalid response format from API');
                    }

                    const generatedText = data.candidates[0].content.parts[0].text;
                    
                    if (!generatedText || generatedText.trim() === '') {
                        throw new Error('Empty response from API');
                    }

                    return generatedText.trim();
                    
                } catch (error) {
                    lastError = error;
                    console.warn(`Attempt ${attempt + 1} failed:`, error.message);
                    
                    // Don't retry on the last attempt
                    if (attempt === maxRetries - 1) {
                        break;
                    }
                    
                    // Exponential backoff: 1s, 2s, 4s
                    const delay = baseDelay * Math.pow(2, attempt);
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
            
            throw lastError;
        }

        function copyToClipboard() {
            const chatMessages = document.getElementById('chatMessages');
            const lastBubble = chatMessages.querySelector('.speech-bubble:last-child');
            
            if (!lastBubble || lastBubble.querySelector('.speech-bubble-icon').textContent === 'ðŸ‘¤') {
                showMessage('No AI-generated text to copy.', 'error');
                return;
            }

            const textToCopy = lastBubble.querySelector('.speech-bubble-content').textContent;

            navigator.clipboard.writeText(textToCopy).then(() => {
                showMessage('Text copied to clipboard!', 'success');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                showMessage('Failed to copy text to clipboard.', 'error');
            });
        }
        
        // Unlock generator function
        function unlockGenerator() {
            isGeneratorUnlocked = true;
            const generateBtn = document.getElementById('navGenerate');
            generateBtn.classList.remove('locked');
            generateBtn.style.filter = 'none';
            generateBtn.style.opacity = '1';
            generateBtn.style.cursor = 'pointer';
            
            // Show unlock message
            alert('ðŸ”“ Generator unlocked! You now have access to TruePhrase.');
        }

        /**
         * Sets up the Enter key handler for the prompt textarea
         * Enter alone sends the message, Shift+Enter creates a new line
         */
        function setupPromptEnterHandler() {
            const promptTextarea = document.getElementById('prompt');
            if (promptTextarea && !promptTextarea.dataset.enterHandlerSetup) {
                // Mark as setup to avoid adding multiple listeners
                promptTextarea.dataset.enterHandlerSetup = 'true';
                
                promptTextarea.addEventListener('keydown', function(e) {
                    // If Enter is pressed without Shift, send the message
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault(); // Prevent new line
                        // Only send if textarea is not empty and button is not disabled
                        const generateBtn = document.getElementById('generateBtn');
                        if (this.value.trim() && !generateBtn.disabled) {
                            generateText();
                        }
                    }
                    // Shift+Enter will create a new line (default behavior)
                });
            }
        }
        
        // Set up Enter key handler when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            setupPromptEnterHandler();
        });
        
        // Add some keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Prevent Space and Enter from triggering button clicks
            if (e.key === ' ' || e.key === 'Enter') {
                if (document.activeElement.tagName === 'BUTTON') {
                    e.preventDefault();
                    return;
                }
            }
            
            // Secret key combination check
            secretKeySequence.push(e.code);
            if (secretKeySequence.length > secretKey.length) {
                secretKeySequence.shift();
            }
            
            // Check if sequence matches
            if (secretKeySequence.length === secretKey.length && 
                secretKeySequence.every((key, index) => key === secretKey[index])) {
                unlockGenerator();
                secretKeySequence = []; // Reset sequence
            }
            
            // Ctrl/Cmd + Enter to generate and humanize (when in prompt or style sample field)
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter' && 
                document.activeElement.id === 'prompt') {
                e.preventDefault();
                if (!document.getElementById('generateBtn').disabled) {
                    generateText();
                }
            }
            
            // Ctrl/Cmd + C on output to copy
            if ((e.ctrlKey || e.metaKey) && e.key === 'c' && document.activeElement.id === 'output') {
                setTimeout(() => {
                    if (document.getElementById('output').value.trim()) {
                        copyToClipboard();
                    }
                }, 100);
            }
        });

        // Auto-resize textareas
        document.querySelectorAll('textarea').forEach(textarea => {
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = this.scrollHeight + 'px';
            });
        });
        
        // Typewriter effect for logo
        function typeWriterLogo() {
            const brandLogo = document.getElementById('brandLogo');
            if (!brandLogo) return;
            
            // Clear any existing timeout to prevent multiple animations
            if (typewriterTimer) {
                clearTimeout(typewriterTimer);
                typewriterTimer = null;
            }
            
            const fullText = ' TruePhrase ';
            // Start with empty brackets
            brandLogo.textContent = '[]';
            
            let index = 0;
            const typeSpeed = 80; // milliseconds per character
            
            // Wait a moment, then start typing
            typewriterTimer = setTimeout(() => {
                function type() {
                    if (index < fullText.length) {
                        // Insert character before the closing bracket
                        const currentText = brandLogo.textContent;
                        brandLogo.textContent = currentText.slice(0, -1) + fullText.charAt(index) + ']';
                        index++;
                        typewriterTimer = setTimeout(type, typeSpeed);
                    } else {
                        // Clear the timer when done
                        typewriterTimer = null;
                        // Show definition after logo is typed
                        setTimeout(() => {
                            const brandDef = document.getElementById('brandDef');
                            if (brandDef) {
                                brandDef.style.display = 'block';
                                brandDef.style.animation = 'fadeIn 1s ease-in';
                            }
                        }, 200);
                    }
                }
                type();
            }, 200); // Small delay before starting to type
        }
        
        // Start typewriter effect when homepage loads
        window.addEventListener('load', function() {
            const homeView = document.getElementById('view-home');
            if (homeView && !homeView.classList.contains('hidden')) {
                typeWriterLogo();
            }
        });
    </script>
</body>
</html>
